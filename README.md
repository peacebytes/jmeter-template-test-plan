# JMeter for load testing #

This is a how-to article on setting up JMeter for doing web services performance test.

Download JMeter: https://jmeter.apache.org/download_jmeter.cgi

### Set-up JMeter ###
Goals: 
Unzip apache-jmeter-5.0.tgz (or .zip) to a folder and we will run JMeter from that location `~/Downloads/apache-jmeter-5.0`

Running JMeter Console UI by opening a new terminal console.
```
cd ~/Downloads/apache-jmeter-5.0/bin
./jmeter
```

To close JMeter console. Press Ctrl+C on terminal console or File > Exit.


### Import template test plan ###
From JMeter Console, File > Open. Select `/{your_local_path}/jmeter-template-test-plan/TestPlan.jmx`

Updating paths to some data files in test plan.

Test Plan > CSV Data Set Config: hit Browse button select file users.txt from /{your_local_path}/jmeter-template-test-plan/users.txt
Test Plan > Number of Users > Add User Request > View Results Tree: hit Browse button select file TestReport.jtl from /{your_local_path}/jmeter-template-test-plan/TestReport.jtl
Test Plan > Number of Users > Get User Request > View Results Tree: hit Browse button select file TestReport.jtl from /{your_local_path}/jmeter-template-test-plan/TestReport.jtl
Test Plan > Summary Report: hit Browse button select file TestReport.jtl from /{your_local_path}/jmeter-template-test-plan/TestReport.jtl

### Tuning load test ###

How to monitor reports

CSV Data Set Config is pretty straightforward.
You will need to pay attention on three values in this screen:
- Variable names: this is the equivalent to a “column name” in the users.txt which are the first line in the file.
- Delimiter: a comma is the default delimiter, but if your file uses tabs, this is the place to mention that.
- User Defined Variables: Setting up endpoint / host of web service and the protocol

HTTP Request Defaults: using the host and protocol set up here for all the requests in test plan
HTTP Header Manager will be a central place to set up headers for all the requests. 
Basically, there are 2 values included in the header
- Content-Type: "application/json"
- Authentication: "Token"
 
OR
 
- Content-Type: "application/json"
- Authentication: "Bearer Token"
Note: There is a space between "Bearer" & "Token" - See below for more details about Token/Authentication

Set up users

Field: Number of Threds (users): the number of users

Field: Ramp-Up Period (in seconds): leave the default value of 0 seconds. This property tells JMeter how long to delay between starting each user. If you set the value to 0, then JMeter will immediately start all of your users.

For example, if you enter a Ramp-Up Period of 5 seconds, JMeter will finish starting all of your users by the end of the 5 seconds. So, if we have 5 users and a 5 second Ramp-Up Period, then the delay between starting users would be 1 second (5 users / 5 seconds = 1 user per second).

Field: Loop Count: enter a value of 2 in the Loop Count field. This property tells JMeter how many times to repeat your test. If you enter a loop count value of 0, then JMeter will run your test only once. To have JMeter repeatedly run your Test Plan, select the Forever checkbox.



To monitor the test, you would need a good amount of users or a good time of ramp-up so that the run is long enough for switching among windows/tabs to see the live reports.
Set up request: Please explore "Add User Request" / "Get User Request" for details how to set it up. For each request, I have added 2 basic elements: Response Assertion and View Results Tree.
Response Assertion: is to be used for verifying the response
View Results Tree: is a report-like to verify all information related to request such as: Sampler result, request headers, request body, response headers, respond body
In Add User Request, we define how the request body looks like by using test data
```
{
"name": "${name}",
"job": "${job}"
}
```
See: `/{your_local_path}/jmeter-template-test-plan/users.txt` for details of test data we have.

### Execute Test Plan ###

By default, reports generated by JMeter is aggregated. If you would prefer to see a new report for every single execution, here is what I have found out to achieve that (I would recommend to make this change to make your report neat and easy to read).
Close JMeter Console
Open file `~/Downloads/apache-jmeter-5.0/bin/jmeter.properties`

resultcollector.action_if_file_exists=ASK
Un-comment that line, and choose a value between 2 options (instead of ASK):
APPEND : Append results to existing file
DELETE : Delete existing file and start a new file

So, Let set it as

resultcollector.action_if_file_exists=DELETE

Save the fle, and re-launching JMeter

As you have imported a template test plan with test data and test report were also set up. Now you should be good for a feel how the load test looks like. If you referred to JMeter's manual, you would find out that it's strongly recommend to run test from terminal console (not UI Console). I would give 2 ways of executions, anyway.
Terminal Console
cd ~/Downloads/apache-jmeter-5.0/bin
./jmeter -n -t load_test/TestPlan.jmx
UI Console
Select Run > Start or click on Play button (a green one)

For a quick run from UI Console (JMeter is not recommended but it works (smile) ). Keys combination are:

The reports in UI Console will automatically get aggregated, to quick clear report combining keys:

Ctrl + E: to empty report from previous runs
Ctrl + R: to run all enabled requests

To view your live report while the test is on-going, clicking on one of 3 reports (Summary Report for all requests or for each request, there is a View Results Tree report).
Ok, you have executed but it was so fast. Now moving back to tuning load test, adjusting the "Ramp-Up Reriod" to have a closer look at live reports
